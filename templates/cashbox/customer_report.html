{% extends "base.html" %}
{% load i18n humanize %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>{% trans "Customer" %}: {{ object.name }}</h1>
</div>

<div class="row g-3">
  <!-- Actions -->
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header fw-semibold">{% trans "Actions" %}</div>
      <div class="card-body d-flex flex-wrap gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'cashbox_create' %}">{% trans "Add Cash Box" %}</a>
        {% if object.cashboxes.first %}
          <a class="btn btn-outline-primary" href="{% url 'transaction_create' %}?cashbox={{ object.cashboxes.first.id }}">{% trans "New Transaction" %}</a>
        {% else %}
          <button class="btn btn-outline-primary" type="button" disabled title="{% trans 'Create a cash box first' %}">{% trans "New Transaction" %}</button>
        {% endif %}
        <a class="btn btn-outline-dark" href="{% url 'customer_transactions' object.pk %}">{% trans "All Transactions Report" %}</a>
        <a class="btn btn-primary" href="{% url 'customer_report_pdf' object.pk %}">{% trans "Export PDF" %}</a>
      </div>
    </div>
  </div>

  <!-- Dashboard / General Information -->
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header fw-semibold">{% trans "General Information" %}</div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-6 mb-3">
            <div class="small text-muted">{% trans "Cash Boxes" %}</div>
            <div class="h4 mb-0">{{ cashboxes_count }}</div>
          </div>
          <div class="col-6 mb-3">
            <div class="small text-muted">{% trans "Transactions" %}</div>
            <div class="h4 mb-0">{{ transactions_count }}</div>
          </div>
          <div class="col-6">
            <div class="small text-muted">{% trans "Currencies" %}</div>
            <div class="h4 mb-0">{{ currencies_count }}</div>
          </div>
          <div class="col-6">
            <div class="small text-muted">{% trans "Total Balance (signed)" %}</div>
            <div class="h4 mb-0">{{ total }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<h5 class="mt-4">{% trans "Per-Currency Balances" %}</h5>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>{% trans "Currency" %}</th>
        <th>{% trans "Balance" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for code, bal in per_currency.items %}
      <tr>
        <td>{{ code }}</td>
        <td>{{ bal }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="2" class="text-center text-muted">{% trans "No transactions yet." %}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-4">{% trans "Cash Boxes" %}</h5>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>{% trans "Name" %}</th>
        <th>{% trans "Currency" %}</th>
        <th>{% trans "Account Type" %}</th>
        <th>{% trans "Balance" %}</th>
        <th>{% trans "Actions" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for cb in cashboxes %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ cb.name|default_if_none:""|default:"â€”" }}</td>
        <td>{{ cb.currency.code }}</td>
        <td>{{ cb.account_type.code }}</td>
        <td>{{ cb.balance }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="{% url 'transaction_create' %}?cashbox={{ cb.id }}">{% trans "Add Transaction" %}</a>
          <a class="btn btn-sm btn-outline-dark" href="{% url 'cashbox_transactions' cb.id %}">{% trans "Report" %}</a>
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'cashbox_transactions_pdf' cb.id %}">{% trans "Export PDF" %}</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center text-muted">{% trans "No cash boxes yet." %}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
